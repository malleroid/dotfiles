# \~/.claude/CLAUDE.md

## Security & Compliance 🛡️

### 🚫 Commit 禁止パターン

- `*.pem`
- `*.key`
- `*.env` / `.env.*`
- `config/credentials.yml.enc`
- `*secrets*`
- `*.p12`
- `id_rsa*` / `id_ed25519*`

> Claude はこれらに一致するファイルを **生成・追加・表示・共有しないこと**。

### ⛔ シェル操作の範囲制限

- Claude が実行するシェルコマンドは **現在の作業ディレクトリ（= このリポジトリ）内** に限定すること。
- リポジトリ外のファイル・ディレクトリを作成／変更／削除／移動する操作は禁止。
- `curl` / `wget` など外部リクエストを発行するコマンドは事前確認なしに実行しない。

### その他原則

1. 社外秘コード・個人情報を含むファイルは公開リポジトリへ push しない。
2. 会社／OSS／副業などの区分に応じた追加ルールは各リポジトリの CLAUDE.md で定義する。

---

## Shell & Environment 🐟

- すべての端末で **fish shell 5.x** を使用。
- dotfiles により `fish_add_path` 等を設定済み。Claude は fish 前提でコマンドを提示する。

---

## Code Style (Placeholder) ✏️

<!-- 後日、共通スタイルを追加する場合に使用 -->

---

## AI Workflow 🤖

### PR 詳細レビュー自動化

PR レビュー時は以下のプロンプトでブランチの変更内容を構造化して要約・分析する

このブランチで作成されているプルリクエストの内容と差分をチェックし、どのような変更が行われたかまとめてください。
次の観点で整理してください：

- 主な変更内容
- 重大な指摘事項
- 軽微な改善提案
- 変更の影響範囲
- 潜在的なリスク・不確実性
- 人間が最終確認すべき観点

### フィードバック優先度（Google Engineering Practices準拠）

**基本原則**: コードの健全性（code health）の継続的改善を重視。完璧さより進捗を優先。

1. **Critical（必須修正）**: コードベースの健全性を悪化させる問題
   - セキュリティ脆弱性、データ損失リスク、重大バグ、設計上の欠陥
   - 記載方法: 前置詞なし、重大性を明示的に記述

2. **Major（強く推奨）**: 放置すると技術的負債となる問題
   - パフォーマンス問題、保守性を損なう設計、エラーハンドリング不足
   - 記載方法: 前置詞なし、または "Consider:" で始める

3. **Minor（検討推奨）**: 改善の余地があるが修正は任意
   - 可読性、リファクタリング機会、設計パターンの提案
   - 記載方法: "Consider:" で始める

4. **Nit（任意）**: 軽微な指摘、実施は著者判断
   - スタイル、命名、コメント、フォーマット
   - 記載方法: **必ず "Nit:" で始める**

5. **Praise（称賛）**: 良い実装の認識
   - エレガントな実装、優れたパターン使用、学習価値のあるコード
   - 記載方法: "Nice:" または "Great:" で始める

### レビュー出力フォーマット

- **\[レビュー判定]**: APPROVE / REQUEST CHANGES / COMMENT
  - APPROVE: コードベースの健全性を改善しており承認可能
  - REQUEST CHANGES: Critical または Major な問題があり修正が必要
  - COMMENT: フィードバックのみ提供
- **\[概要]**: 変更内容と全体的な印象。コードベースの健全性への影響を記述
- **\[Critical Issues]** (該当時): マージ前必須修正（ファイルパス:行番号、問題、修正案、根拠）
- **\[Major Issues]** (該当時): 強く推奨される改善点（同上）
- **\[Minor Suggestions]** (該当時): Consider: で始まる検討推奨事項
- **\[Nits]** (該当時): Nit: で始まる軽微な改善提案（実施は著者判断）
- **\[Praise]** (該当時): Nice: / Great: で始まる良い実装の認識
- **\[テスト観点]**: 追加・更新すべきテスト、検証項目
- **\[影響範囲]**: 変更による他システム・ユーザーへの影響
- **\[人間が最終確認すべき観点]**: AI では判断困難な業務ロジック・設計判断

---

## Repository-Specific Overrides (例示) 📝

```markdown
## If repo includes "github.com/your-company/"

# - default branch: main

# - branch naming: feature/JIRA-123-description

# - CI: GitHub Actions, secrets via OIDC
```

---

## メンテナンス指針

- dotfiles 更新時にこのファイルも点検し、不要行を削除・新規禁止パターンを追加。
- ファイルサイズは **50 KB 未満** を目安に維持。大きくなる場合は各リポジトリ側へ移動。
